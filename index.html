<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ¯æ—¥ä¸€è¨€ Â· Daily Quote</title>
  <meta name="description" content="ä¸€ä¸ªçº¯é™æ€ HTML é¡µé¢ï¼šè‡ªåŠ¨/æ‰‹åŠ¨æ›´æ–°æ¯æ—¥ä¸€è¨€ä¸æ¯æ—¥èƒŒæ™¯å›¾ï¼ˆå‡æ¥è‡ªç½‘ç»œ APIï¼‰ã€‚" />
  <style>
    :root {
      --bg-blur: 6px;
      --card-bg: rgba(255, 255, 255, 0.18);
      --card-border: rgba(255, 255, 255, 0.25);
      --text-main: #ffffff;
      --text-sub: rgba(255,255,255,.9);
      --shadow: 0 10px 30px rgba(0,0,0,.25);
    }
    html, body {
      height: 100%;
    }
    body {
      margin: 0;
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      color: var(--text-main);
      background-color: #0b1020;
      background-position: center;
      background-size: cover;
      background-attachment: fixed;
      background-repeat: no-repeat;
    }
    .overlay {
      position: fixed;
      inset: 0;
      background: linear-gradient(180deg, rgba(0,0,0,.15), rgba(0,0,0,.35));
      backdrop-filter: blur(var(--bg-blur));
      -webkit-backdrop-filter: blur(var(--bg-blur));
      pointer-events: none;
    }
    .wrap {
      position: relative;
      min-height: 100%;
      display: grid;
      place-items: center;
      padding: 16px;
    }
    .card {
      width: min(860px, 95vw);
      border: 1px solid var(--card-border);
      background: var(--card-bg);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 24px 20px 20px;
      backdrop-filter: blur(4px);
    }
    .row {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }
    .title {
      font-size: clamp(16px, 2.2vw, 22px);
      font-weight: 700;
      letter-spacing: .3px;
      color: var(--text-sub);
      display: flex;
      align-items: center;
      gap: 10px;
    }
    .title small { opacity: .9; font-weight: 500; }
    .quote {
      margin: 18px 0 8px;
      font-size: clamp(20px, 3.2vw, 34px);
      line-height: 1.5;
      font-weight: 700;
      text-shadow: 0 2px 8px rgba(0,0,0,.2);
    }
    .from {
      margin-top: 6px;
      font-size: clamp(14px, 1.6vw, 16px);
      color: var(--text-sub);
    }
    .meta {
      margin-top: 14px;
      display: flex;
      gap: 14px;
      flex-wrap: wrap;
      align-items: center;
      color: var(--text-sub);
      font-size: 13px;
    }
    .btns { display: flex; gap: 10px; flex-wrap: wrap; }
    button {
      border: 1px solid rgba(255,255,255,.4);
      color: var(--text-main);
      background: rgba(255,255,255,.12);
      border-radius: 999px;
      padding: 8px 14px;
      font-weight: 600;
      font-size: 14px;
      cursor: pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      backdrop-filter: blur(2px);
    }
    button:hover { background: rgba(255,255,255,.18); border-color: rgba(255,255,255,.65); }
    button:active { transform: translateY(1px) scale(.99); }
    .hint { font-size: 12px; opacity: .85; }
    .footer {
      margin-top: 18px;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
      color: var(--text-sub);
      font-size: 12px;
    }
    a { color: #dfe8ff; }
    .loader {
      display:inline-block; width:18px; height:18px; border-radius:50%; border:3px solid rgba(255,255,255,.35); border-top-color:#fff; animation:spin .9s linear infinite; vertical-align:-4px; margin-right:8px;
    }
    @keyframes spin { to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="overlay" aria-hidden="true"></div>
  <div class="wrap">
    <main class="card" role="main" aria-live="polite">
      <div class="row">
        <div class="title">ğŸ“œ æ¯æ—¥ä¸€è¨€ <small id="dateText">åŠ è½½ä¸­â€¦</small></div>
        <div class="btns">
          <button id="refreshBtn" title="æ‰‹åŠ¨æ›´æ–°ä¸€è¨€ä¸èƒŒæ™¯">ğŸ”„ æ‰‹åŠ¨æ›´æ–°</button>
          <button id="copyBtn" title="å¤åˆ¶å½“å‰ä¸€è¨€">ğŸ“‹ å¤åˆ¶æ–‡æœ¬</button>
        </div>
      </div>

      <div class="quote" id="quoteText"><span class="loader"></span>æ­£åœ¨è·å–ä»Šæ—¥çš„ä¸€è¨€â€¦</div>
      <div class="from" id="quoteFrom"></div>

      <div class="meta">
        <div>æ¥æºï¼š<a href="https://hitokoto.cn/" target="_blank" rel="noopener">ä¸€è¨€ (v1.hitokoto.cn)</a></div>
        <div>èƒŒæ™¯å›¾ï¼š<a href="https://picsum.photos/" target="_blank" rel="noopener">Picsum Photos</a></div>
        <div id="status"></div>
      </div>

      <div class="footer">
        <div class="hint">è¯´æ˜ï¼šé¡µé¢ä¸ºçº¯é™æ€ HTMLã€‚è‡ªåŠ¨æŒ‰â€œè‡ªç„¶æ—¥â€æ›´æ–°å†…å®¹ï¼ˆæœ¬åœ°ç¼“å­˜é¿å…é‡å¤è¯·æ±‚ï¼‰ï¼Œä¹Ÿæ”¯æŒæ‰‹åŠ¨æ›´æ–°ã€‚</div>
        <div>Â© <span id="year"></span> Daily Quote</div>
      </div>
    </main>
  </div>

  <script>
    const QUOTE_API = 'https://v1.hitokoto.cn/?encode=json';
    const BG_BASE = 'https://picsum.photos';
    const BG_SIZE = { w: window.innerWidth, h: window.innerHeight }; // è‡ªé€‚åº”çª—å£å¤§å°

    const fmtDate = (d = new Date()) => {
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      return `${y}-${m}-${day}`;
    };
    const todayKey = () => fmtDate();
    const setStatus = (msg) => { document.getElementById('status').textContent = msg || ''; };

    function setBackground(seed) {
      const url = `${BG_BASE}/seed/${encodeURIComponent(seed)}/${window.innerWidth}/${window.innerHeight}`;
      document.body.style.backgroundImage = `url('${url}')`;
    }

    async function fetchQuote(force = false) {
      const key = 'dq_quote';
      const keyDate = 'dq_quote_date';
      const savedDate = localStorage.getItem(keyDate);
      const isToday = savedDate === todayKey();

      if (!force && isToday) {
        const cached = localStorage.getItem(key);
        if (cached) {
          try { return JSON.parse(cached); } catch (_) {}
        }
      }

      const res = await fetch(QUOTE_API, { cache: 'no-store' });
      if (!res.ok) throw new Error('ä¸€è¨€ API è¯·æ±‚å¤±è´¥');
      const data = await res.json();
      const pack = {
        text: data.hitokoto || '',
        from: data.from_who || data.from || '',
        id: data.uuid || data.id || '',
        ts: Date.now()
      };
      localStorage.setItem(key, JSON.stringify(pack));
      localStorage.setItem(keyDate, todayKey());
      return pack;
    }

    function renderQuote(q) {
      const qEl = document.getElementById('quoteText');
      const fEl = document.getElementById('quoteFrom');
      qEl.textContent = q.text || 'ï¼ˆä»Šå¤©çš„è¯è¯­æ‚„æ‚„æºœèµ°äº†â€¦ï¼‰';
      fEl.textContent = q.from ? `â€”â€” ${q.from}` : '';
    }

    async function init(auto = true) {
      document.getElementById('year').textContent = new Date().getFullYear();
      document.getElementById('dateText').textContent = fmtDate();

      const todaySeed = todayKey();
      setBackground(todaySeed);

      try {
        const q = await fetchQuote(false);
        renderQuote(q);
        setStatus('å·²åŠ è½½');
      } catch (err) {
        console.error(err);
        setStatus('è·å–å¤±è´¥ï¼Œå·²å±•ç¤ºç¼“å­˜æˆ–å ä½å†…å®¹');
        const cached = localStorage.getItem('dq_quote');
        if (cached) {
          try { renderQuote(JSON.parse(cached)); } catch (_) {}
        }
      }
    }

    document.getElementById('refreshBtn').addEventListener('click', async () => {
      setStatus('åˆ·æ–°ä¸­â€¦');
      setBackground(Date.now());
      try {
        const q = await fetchQuote(true);
        renderQuote(q);
        setStatus('å·²åˆ·æ–°');
        document.getElementById('dateText').textContent = fmtDate();
      } catch (err) {
        console.error(err);
        setStatus('åˆ·æ–°å¤±è´¥');
      }
    });

    document.getElementById('copyBtn').addEventListener('click', async () => {
      const text = document.getElementById('quoteText').textContent;
      const from = document.getElementById('quoteFrom').textContent;
      const payload = from ? `${text}\n${from}` : text;
      try {
        await navigator.clipboard.writeText(payload);
        setStatus('å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
      } catch {
        setStatus('å¤åˆ¶å¤±è´¥ï¼šè¯·æ‰‹åŠ¨é€‰ä¸­å¤åˆ¶');
      }
    });

    window.addEventListener('resize', () => setBackground(todayKey()));

    init();
  </script>
</body>
</html>
